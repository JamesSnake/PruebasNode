var jsonTojson = require('../index');

var template = {
  "RequestHeader": {
    "RequestType": "UserAdd",
    "RequestCreatedDate": ""
  },
  "RqMsg": ['$.user',
    {
      "RequestID": '$.id',
      "RqMsgCreatedDt": '',
      "UserRecord": {
        "UserId": "$.id",
        "UserInfo": {
          "UserStatusCode": "$.userStatus",
          "UserIdent": {
            "UserFirstName": "$.userFName",
            "UserLastName": "$.userLName"
          },
          "UserType": "$.accountType"
        },
        "UserStatus": {
          "StatusCode": "$.refreshinfo.statusCode"
        }
      }
    }
  ]
}

var data = {
  "user": [
    {
      "userStatus": "ACTIVE",
      "userFName": "Tom",
      "userLName": "Smith",
      "id": 123456789,
      "lastUpdated": "2016-03-25T00:13:21Z",
      "accountType": "Administrator",
      "refreshinfo": {
        "statusCode": 0,
        "statusMessage": "OK"
      },
      "balance": {
        "amount": 99.99,
        "currency": "USD"
      }
    },
    {
      "userStatus": "ACTIVE",
      "userFName": "Harry",
      "userLName": "Pott",
      "id": 234567890,
      "lastUpdated": "2016-03-25T00:13:21Z",
      "accountType": "Power User",
      "refreshinfo": {
        "statusCode": 0,
        "statusMessage": "OK"
      },
      "balance": {
        "amount": 0.00,
        "currency": "USD"
      }
    }
  ]
};


console.log(JSON.stringify(data));
data = JSON.stringify(data);
var obj = JSON.parse(data);
console.log(obj.user.length);
for(var i = 0; i < obj.user.length; i++) {
  obj.user[i]["holders"] = [{"balance": { "amount": obj.user[i].balance.amount, "currency": obj.user[i].balance.currency}}];
  console.log(JSON.stringify(obj));
}

console.log(JSON.stringify(obj));
data = obj;

var operate= [
  {
    run: function () {
      var d = new Date();
      var n = d.toJSON().toString();

      return n;
    },
    on: "RqCreatedDt"
  },
  {
    run: function () {
      var d = new Date();
      var n = d.toJSON().toString();

      return n;
    },
    on: "RqMsgCreatedDt"
  },
  {
    run: function() { return "AccountMod"},
    on: "RqUID"
  }
];

var result = jsonTojson.transform(data, template, operate);
console.log(JSON.stringify(result));
